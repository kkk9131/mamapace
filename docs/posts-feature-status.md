# ポスト機能 実装状況と拡張計画

## 実装済み（このブランチ）
- フィード（ホーム）
  - Supabase RPC（get_home_feed）で取得、プロフィールJOIN・共感/コメント件数を集計
  - 無限スクロール / プルリフレ
  - 楽観更新（共感トグル）と失敗時ロールバック＋通知
  - Realtime購読で共感/コメント件数のライブ更新
  - スケルトン表示（読み込み時）
- 投稿作成
  - 300文字上限＋残り文字数表示
  - 成功時にホームへ復帰し即リロード
  - エラー通知の統一（notifyError）
- あなた（プロフィール）
  - 「すべて見る」遷移（ネストスクロール回避）
  - ポスト数表示（get_user_post_count RPC／直接countのフォールバック）
- 共感したポスト一覧
  - Supabase RPC（get_liked_posts）で取得
  - 共感失敗時の通知
- コメント
  - 一覧/作成/削除（本人のみ）
  - コメント一覧はpost単位でRealtime購読（INSERT/DELETEで即反映）
  - 入力欄300文字上限＋残り文字数表示、キーボード閉じやすさ改善
- 削除
  - 投稿削除（本人のみ）: delete_post RPC＋UIボタン
  - コメント削除（本人のみ）: delete_comment RPC＋UIボタン
- アクセシビリティ
  - 主要ボタン（作成/共感/コメント/削除/遷移など）にrole/label付与

## 拡張機能（次フェーズ候補）
- URL自動リンク化
  - 本文中のURLを検出してタップ可能に（セーフブラウザ/外部リンク警告の導入）
- Liked/MyPosts の Realtime 購読拡張
  - Liked: 自分のpost_reactions（INSERT/DELETE）でリストを自動増減
  - MyPosts: 自分のposts（INSERT/DELETE）で自動更新
- スケルトンの細分化
  - コメント/プロフィール用スケルトンの最適化
- 長文の改善
  - 「もっと見る」状態の保持（画面遷移後も）
- E2E/統合テスト
  - 投稿→フィード反映、共感トグル、コメント作成→一覧反映の陽性ケース
  - 削除（投稿/コメント）
- 画像/動画の添付（後続）
  - ストレージ設計（公開/非公開、期限付URL）
  - 圧縮/リサイズとアップロードUI
  - サムネイルとプレーヤー（動画はexpo-video）
- セキュリティ/権限
  - RPCへのGRANT最終確認（anon/authenticated）
  - RLSポリシーの見直し（編集/削除拡張時）

## 運用メモ
- Realtime購読はネットワーク断復帰時の再購読が必要。現在は画面マウント時購読/アンマウント時解除。
- 件数はDB集計＋Realtime増減で一貫性を担保。ローカル増分は使用しない。
- 既存のSupabase Auth未使用環境でも動くよう、すべてRPCファースト＋フォールバックで実装。
